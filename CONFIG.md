# 上证50ETF期权 尾部风控高级策略看板 (v4.0) - 系统配置与规范文档

## 一、项目定性与核心参数

这是一个基于**纯量化统计与极严苛尾部风控精神**设计的做空波动率（Short Volatility）大屏。
核心标的极其明确：**上证50ETF期权 (对应现货: 510050.SS)**。

### 1.1 核心风控阈值配置
| 参数 | 系统推荐值 | 理论内涵 |
|------|------------|----------|
| **建仓虚值目标(OTM)** | **11.0%** | 在确认泡沫期（BSADF触发）时，只卖出偏离现价极其遥远、距离发生实质履约风险概率极低的极度虚值期权，获取稳健 Theta。 |
| **绝对止损认怂线** | **6.4%** | 若标的行情出现向不利方向单边运动，导致原本11%的深度虚值被压缩至不足6.4%（或被计算跌破 95% GARCH VaR 警戒线），**必须无条件即时止损平仓**，防止千日砍柴一日烧。 |
| **GARCH 滚动窗口** | **250个交易日** | 确保波动率引擎能够覆盖过去整整一年的市场周期波动。 |
| **日化RV预警阈值** | **历史均值+2σ** | 用于盘中捕捉日线级别尚未来得及破位的“黑天鹅”突发脉冲。 |

---

## 二、数据流架构配置 (双路无感直连)

在 v4.0 版本中，系统全面移除了本地代理（VPN）的强制绑定，全部采用国内直连策略：

### 2.1 长周期历史底座：yfinance
*   **接入品种**：`510050.SS` (上证50ETF 场内现货)
*   **获取频率**：每日盘后更新 (日频，Daily)
*   **提取字段**：`Date`, `Open`, `High`, `Low`, `Close`, `Volume`
*   **用途**：长周期、低噪声，专门服务于 **BSADF 泡沫测试回归引擎** 与 **GARCH 日频 VaR(在险价值)预测**。长序列分析要求历史无缺失跳空，yfinance 提供极为稳定的后复权数据。

### 2.2 盘中高频探测雷达：akshare
*   **接入品种一**：`option_current_em()`（期权实时行情）
    *   **提取字段**：`代码`, `名称`, `最新价`, `行权价`, `隐含波动率`
    *   **频率**：盘中轮询实时 (可设置 5s - 1分钟 刷新)
    *   **用途**：构建实时期权靶心监控表，运算**当前虚值深度**以及与**95% 认怂线**的安全垫差值。
*   **接入品种二**：`stock_zh_a_hist_min_em`（上证50分钟级别 K线）
    *   **提取字段**：`时间`, `收盘` (由于接口迭代，具体字段由 `indicators.py` 内动态适配)
    *   **频率**：5分钟连贯K线
    *   **用途**：计算盘中日化已实现波动率 (Realized Volatility, RV)，作为盘中突发风险的物理隔离闸。

---

## 三、部署及运行规范

### 3.1 Python 基础依赖
推荐使用 Python 3.9 ~ 3.12 的隔离虚拟环境：
```bash
pip install streamlit pandas numpy akshare arch statsmodels scipy yfinance
pip install pyecharts streamlit-echarts
```

### 3.2 运行指令
在项目根目录拉起服务：
```bash
streamlit run app.py
```
> *注：如部署到公有云（如 Streamlit Cloud 等境外云服务商），依然可以兼容这些数据流，因为 yFinance 是国际通用库，akshare 的 em (东方财富) 接口也支持多数无头节点的抓取。*

---

## 四、安全与交易法则（Must Obeys）

1.  **绝不扛单法则**：系统的核心胜率来自于对剩余 10% 尾部风险的绝对切割。当期权表单中出现红字预警，或者现价打入 GARCH `±var_95` 的认怂线时，系统即判定防线崩溃。此时**不论账面面临多大浮亏，必须买入平仓**。
2.  **不接飞刀法则**：在 BSADF 指示器没有处于“泡沫发酵期”且未出现“衰竭转向”确立之前，即便波动率短期走高也不要进行赌博式卖出，大概率会被趋势顺劈。
3.  **零杠杆运行**：卖方策略自带天然高敞口。请严格按初始保证金为 1 的 5%~8% 的年化预期来建立头寸，严禁过度加码。
